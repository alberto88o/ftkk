<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FootShop — Payment</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header class="site-header">
  <div class="container header-inner">
    <div class="brand">
      <h1>FOOBLITZ</h1>
      <p class="tag">Official & Replica Jerseys</p>
    </div>

    <nav class="main-nav">
      <a href="index.html">Home</a>
      <a href="products.html">Products</a>
      <a href="payment.html">Payment</a>
      <a href="contact.html">Contact</a>
    </nav>

    <div class="header-actions">
      <button id="cart-btn" class="cart-btn">Cart <span id="cart-count">0</span></button>
    </div>
  </div>
</header>

<main class="container">
  <!-- UPI / GPay quick-pay -->
<section id="upi-pay" style="max-width:720px;margin-top:18px">
  <h3>Pay with UPI / GPay</h3>
  <p>Click the button below on your phone to open Google Pay or another UPI app with the payment details prefilled.</p>

  <!-- Update the values below: pa (VPA), pn (payee name), am (amount in rupees), tn (note) -->
  <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center">
    <button id="gpay-btn" class="primary-btn" style="min-width:220px">Pay with GPay / UPI</button>

    <!-- QR fallback: auto-generate QR from UPI URI so desktop users can scan -->
    <div id="upi-qr" style="padding:8px;background:#fff;border-radius:8px;box-shadow:0 4px 10px rgba(0,0,0,.06)">
      <img id="qr-img" alt="UPI QR" src="" style="width:150px;height:150px" />
      <div style="font-size:13px;text-align:center;margin-top:6px">Scan to pay (UPI)</div>
    </div>
  </div>

  <p style="margin-top:8px;color:#666;font-size:13px">Note: This is a client-side UPI link — works on mobile and opens the UPI app. For production payment verification, use a server-side gateway (Razorpay/Cashfree).</p>
</section>

<script>
/* Quick UPI / GPay client-side behavior */
/* Replace these variables with your values */
const merchantVPA = 'yourmerchant@upi';     // <-- put your UPI ID here (example: merchant@okaxis)
const merchantName = 'FOOBLITZ';            // <-- display name
const paymentNote = 'FOOBLITZ order';       // <-- note/description

function formatPriceNumber(x){ return Number(x).toFixed(2); }

// build UPI URI - we set amount dynamically from cart total if available
function buildUpiUri(amount) {
  // amount must be in rupees like 1999.00
  const pa = encodeURIComponent(merchantVPA);
  const pn = encodeURIComponent(merchantName);
  const am = encodeURIComponent(formatPriceNumber(amount));
  const tn = encodeURIComponent(paymentNote);
  return `upi://pay?pa=${pa}&pn=${pn}&am=${am}&tn=${tn}&cu=INR`;
}

// If you have a cart total from localStorage:
function getCartTotal() {
  try{
    const cart = JSON.parse(localStorage.getItem('fs_cart')||'{}');
    return Object.values(cart).reduce((s,i)=> s + (i.price * i.qty || 0), 0);
  }catch(e){ return 0; }
}

// when user clicks "Pay with GPay"
document.getElementById('gpay-btn').addEventListener('click', ()=>{
  const total = getCartTotal();
  if(total <= 0){
    alert('Your cart is empty. Add items first.');
    return;
  }
  // build upi uri with total
  const upi = buildUpiUri(total);
  // set location to UPI URI — opens the UPI app on mobile
  window.location.href = upi;
});

// generate QR for desktop users (Google Chart API quick QR)
function setUpiQR(){
  const total = getCartTotal();
  const upi = buildUpiUri(total);
  // Use a simple QR service — this creates a QR image of the UPI URI
  const qrUrl = 'https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=' + encodeURIComponent(upi);
  document.getElementById('qr-img').src = qrUrl;
}
setUpiQR();
</script>

  <h2>Checkout / Payment</h2>

  <div id="payment-area">
    <p id="no-items">Loading your cart...</p>

    <div id="summary" style="display:none;max-width:700px">
      <div id="summary-list"></div>
      <div style="margin-top:16px;font-weight:700">Total: <span id="summary-total">₹0</span></div>

      <div style="margin-top:18px">
        <button id="do-checkout" class="primary-btn">Confirm & Place Order (Demo)</button>
      </div>

      <div style="margin-top:12px;color:#666">
        <p>Payment options (demo): Cash on Delivery (COD) or contact us to pay via UPI/Bank transfer.</p>
      </div>
    </div>

    <div id="thankyou" style="display:none;margin-top:20px">
      <h3>Thank you — order placed!</h3>
      <p>We cleared the demo cart. For real payment integration, we can add Razorpay or PayPal.</p>
    </div>
  </div>
</main>

<footer class="site-footer">
  <div class="container">
    <p>© 2025 FootShop. Built with ❤️</p>
  </div>
</footer>

<script>
  // Reads the same cart key used by the store (fs_cart)
  function formatPrice(n){ return '₹' + Number(n).toLocaleString(); }
  const cart = JSON.parse(localStorage.getItem('fs_cart') || '{}');
  const keys = Object.keys(cart);
  const summary = document.getElementById('summary');
  const summaryList = document.getElementById('summary-list');
  const summaryTotal = document.getElementById('summary-total');
  const noItems = document.getElementById('no-items');

  if(keys.length === 0){
    noItems.textContent = 'Your cart is empty. Add products from the Products page.';
  } else {
    noItems.style.display = 'none';
    summary.style.display = 'block';
    let total = 0;
    keys.forEach(id=>{
      const it = cart[id];
      const line = document.createElement('div');
      line.style.padding = '8px 0';
      line.innerHTML = `<strong>${it.name}</strong> — ${formatPrice(it.price)} × ${it.qty} = <strong>${formatPrice(it.price*it.qty)}</strong>`;
      summaryList.appendChild(line);
      total += it.price * it.qty;
    });
    summaryTotal.textContent = formatPrice(total);
  }

  document.getElementById('do-checkout').addEventListener('click', ()=>{
    if(keys.length === 0){ alert('Cart is empty'); return; }
    // Demo behaviour: clear the cart and show thank you
    localStorage.removeItem('fs_cart');
    summary.style.display = 'none';
    document.getElementById('thankyou').style.display = 'block';
    // update cart count in header if user returns (script.js will update on other pages)
    document.getElementById('cart-count').textContent = 0;
  });

  // small hook to open cart drawer if present (for consistency)
  const cartBtn = document.getElementById('cart-btn');
  if(cartBtn) cartBtn.addEventListener('click', ()=> {
    const drawer = document.getElementById('cart-drawer');
    if(drawer) drawer.classList.add('open');
  });
</script>

</body>
</html>

